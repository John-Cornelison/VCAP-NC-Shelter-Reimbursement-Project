---
title: "NC_shelter_reimbursement_analysis"
author: "John Cornelison"
date: "12/14/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Research Notes

* There are instances when there is an operating and cost-per-animal cost with 0 intakes. I assume this is taking care of existing animals
* There are instances when there is no operating and cost-per-animal cost with multiple intakes. Just didn't get the operation cost.
* Is the cost-per-animal calculated by the number of animals entering the shelter that year, or the total number of animals in the shelter 

from previous year too. The cost per animal is not calculated by the current years intake. So, I feel like it is possible that higher cost could be an indicator of longer LOS. It also could be an indicator of type of shelter/rescue. There may be individual person rescues for example.

Live Release Rate: Adopted + Returned / Adopted + Returned + Euthanized

Boxplot cleaning info:

When removing years where facilities didn't report an operating cost, operation costs less than 6, and outliers, there were 1072 instances from 2010 to 2022



```{r, include = FALSE}


```


```{r, include = FALSE}
#Working Directory
#Desktop
#setwd("C:/Users/john/Documents/GitHub_Data/VCAP-NC-Shelter-Reimbursement-Project-Data")

#Laptop
setwd("C:/Users/johnc/Documents/GitHub_Data/VCAP-NC-Shelter-Reimbursement-Project-Data")


###Libraries
library(plotly)
library(tidyverse)
library(readxl)
library(googlesheets4)
library(stringr)


###Reading in Data
NC_shelter_raw <- read_xlsx("Shelter&ReimburseReformatted.xlsx", sheet = "Shelter Final")
NC_reimbursements_raw <- read_xlsx("Shelter&ReimburseReformatted.xlsx", sheet = "Reimbursement Final")


```


```{r, include=FALSE}
#This block of code was used for sharing information with colaborator


# species_condensed_count <- species_table_condensed %>%
#   group_by(Species_Condensed) %>%
#   summarise(Count = sum(Intake))
# 
# 
# species_count <- species_table_condensed %>% 
#   group_by(Species_Condensed, Species) %>% 
#   summarise(Count = sum(Intake))


# gs4_deauth()
# gs4_auth()
# 
# my_sheet <- gs4_create("Animal Count and Catagorization")
# 
# write_sheet(species_condensed_count, ss = my_sheet)
# write_sheet(species_count, ss = my_sheet)
# 






```


```{r, include = FALSE}
#Data Cleaning

species_table <- NC_shelter_raw %>% 
  select(1:4, 7:874) %>% 
  pivot_longer(
    cols = 5:872,
    names_to = c("Species", "Category"),
    names_sep = "_",
    values_to = c("Count")) %>%
  pivot_wider(
    names_from = "Category",
    values_from = "Count") %>% 
  mutate(remove_row = case_when(Intake == 0 & Adopted == 0 & Euthanized == 0 & Returned == 0 & Euthanized == 0 ~ TRUE,
                                TRUE ~ FALSE)) %>% 
  filter(remove_row == FALSE) %>% 
  select(-remove_row) %>% 
  mutate(Intake = case_when(Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Dog" ~ 624,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Cat" ~ 1012,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Raccoon" ~ 64,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Opossum" ~ 55,
                            TRUE ~ Intake),
         Adopted = case_when(Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Dog" ~ 380,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Cat" ~ 98,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Raccoon" ~ 0,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Opossum" ~ 0,
                            TRUE ~ Adopted),
         Returned = case_when(Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Dog" ~ 58,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Cat" ~ 16,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Raccoon" ~ 0,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Opossum" ~ 55,
                            TRUE ~ Returned),
         Euthanized = case_when(Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Dog" ~ 186,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Cat" ~ 899,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Raccoon" ~ 64,
                            Facility_Name == "Montgomery Co. Animal Control Facility" & Year == 2019 & Species == "Opossum" ~ 0,
                            TRUE ~ Euthanized)) %>%
  #2020
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Dog", Intake = 416, Adopted = 149, Returned = 79, Euthanized = 18) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Cat", Intake = 387, Adopted = 213, Returned = 13, Euthanized = 77) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Raccoon", Intake = 10, Adopted = 0, Returned = 0, Euthanized = 3) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Opossum", Intake = 3, Adopted = 0, Returned = 0, Euthanized = 1) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Fox", Intake = 1, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Bat", Intake = 4, Adopted = 0, Returned = 0, Euthanized = 2) %>%
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
                             Species = "Skunk", Intake = 1, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "71", Year = 2020, "County/City" = "Stanly", Facility_Name = "Stanly County Animal Protective Ser",
          Species = "Dog", Intake = 385, Adopted = 207, Returned = 106, Euthanized = 193) %>%
  add_row(LIC = "71", Year = 2020, "County/City" = "Stanly", Facility_Name = "Stanly County Animal Protective Ser",
          Species = "Cat", Intake = 628, Adopted = 324, Returned = 10, Euthanized = 362) %>% 
  add_row(LIC = "129", Year = 2020, "County/City" = "Tyrrell", Facility_Name = "Tyrrell County Animal Shelter",
          Species = "Dog", Intake = 51, Adopted = 34, Returned = 9, Euthanized = 7) %>%
  add_row(LIC = "129", Year = 2020, "County/City" = "Tyrrell", Facility_Name = "Tyrrell County Animal Shelter",
          Species = "Cat", Intake = 142, Adopted = 32, Returned = 1, Euthanized = 109) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Dog", Intake = 926, Adopted = 376, Returned = 359, Euthanized = 134) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Cat", Intake = 530, Adopted = 394, Returned = 33, Euthanized = 74) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Rabbit", Intake = 25, Adopted = 25, Returned = 0, Euthanized = 0) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Raccoon", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 10) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Opossum", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 3) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Bat", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 3) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Coyote", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 2) %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Chicken", Intake = 15, Adopted = 8, Returned = 2, Euthanized = 5) %>% 
  #2021
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Species = "Dog", Intake = 451, Adopted = 60, Returned = 136, Euthanized = 59) %>%
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Species = "Cat", Intake = 494, Adopted = 142, Returned = 8, Euthanized = 125) %>% 
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Species = "Rabbit", Intake = 17, Adopted = 2, Returned = 2, Euthanized = 6) %>% 
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Species = "Raccoon", Intake = 17, Adopted = 2, Returned = 2, Euthanized = 7) %>% 
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Species = "Opossum", Intake = 16, Adopted = 2, Returned = 1, Euthanized = 7) %>%
  add_row(LIC = "147", Year = 2021, "County/City" = "Martin", Facility_Name = "Martin County Sheriff'S Office Animal Shelter",
          Species = "Dog", Intake = 208, Adopted = 90, Returned = 42, Euthanized = 78) %>% 
  add_row(LIC = "147", Year = 2021, "County/City" = "Martin", Facility_Name = "Martin County Sheriff'S Office Animal Shelter",
          Species = "Cat", Intake = 280, Adopted = 65, Returned = 2, Euthanized = 200) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Dog", Intake = 1000, Adopted = 521, Returned = 233, Euthanized = 139) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Cat", Intake = 564, Adopted = 457, Returned = 26, Euthanized = 62) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Rabbit", Intake = 12, Adopted = 12, Returned = 1, Euthanized = 2) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Raccoon", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 30) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Opossum", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 22) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Bat", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 4) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Chicken", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 7) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Fox", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 4) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Turtle", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 2) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Squirrel", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 5) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Deer", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 1) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Bear", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 1) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Gerbil", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 6) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Alligator", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 1) %>%
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Species = "Coyote", Intake = 0, Adopted = 0, Returned = 0, Euthanized = 1) %>%
  add_row(LIC = "115", Year = 2021, "County/City" = "Northampton", Facility_Name = "Northampton County Animal Shelter",
          Species = "Dog", Intake = 194, Adopted = 153, Returned = 30, Euthanized = 11) %>%
  add_row(LIC = "115", Year = 2021, "County/City" = "Northampton", Facility_Name = "Northampton County Animal Shelter",
          Species = "Cat", Intake = 188, Adopted = 167, Returned = 3, Euthanized = 18) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Dog", Intake = 437, Adopted = 42, Returned = 69, Euthanized = 67) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Cat", Intake = 632, Adopted = 86, Returned = 11, Euthanized = 431) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Rabbit", Intake = 3, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Raccoon", Intake = 1, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Cattle", Intake = 26, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Duck", Intake = 4, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Chicken", Intake = 47, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Turkey", Intake = 9, Adopted = 0, Returned = 0, Euthanized = 0) %>%
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Species = "Goat", Intake = 1, Adopted = 0, Returned = 0, Euthanized = 0) %>% 
  mutate(Outcome = Adopted + Euthanized + Returned) %>% 
  relocate(Outcome, .after = Intake)

#write_csv(species_table, "species_table.csv")

expenses_table <- NC_shelter_raw %>% 
  select(1:6) %>% 
  add_row(LIC = "92", Year = 2020, "County/City" = "Jackson", Facility_Name = "Jackson County Animal Shelter",
          Operating_Expense = "316891", Cost_Per_Animal = "394.63") %>% 
  add_row(LIC = "72", Year = 2020, "County/City" = "Stanly", Facility_Name = "Stanly County Animal Protective Ser",
          Operating_Expense = "475000", Cost_Per_Animal = "468.90") %>%
  add_row(LIC = "129", Year = 2020, "County/City" = "Tyrrell", Facility_Name = "Tyrrell County Animal Shelter",
          Operating_Expense = "11214.67", Cost_Per_Animal = "57.81") %>% 
  add_row(LIC = "16", Year = 2020, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
          Operating_Expense = "1537722", Cost_Per_Animal = "870") %>% 
  add_row(LIC = "377", Year = 2021, "County/City" = "Chatham", Facility_Name = "Chatham County Sheriff'S Office Animal Resource Center",
          Operating_Expense = "1104472", Cost_Per_Animal = "1110.02") %>% 
  add_row(LIC = "147", Year = 2021, "County/City" = "Martin", Facility_Name = "Martin County Sheriff'S Office Animal Shelter",
           Operating_Expense = "119576.57", Cost_Per_Animal = "408.84") %>% 
  add_row(LIC = "16", Year = 2021, "County/City" = "New Hanover", Facility_Name = "New Hanover Co Sheriffs Ofc Animal Svcs Unit",
           Operating_Expense = "293568", Cost_Per_Animal = "890") %>% 
  add_row(LIC = "115", Year = 2021, "County/City" = "Northampton", Facility_Name = "Northampton County Animal Shelter",
          Operating_Expense = "48394.56", Cost_Per_Animal = "126.69") %>% 
  add_row(LIC = "63", Year = 2021, "County/City" = "Stokes", Facility_Name = "Stokes County Animal Shelter",
          Operating_Expense = "330320", Cost_Per_Animal = "290.70") %>% 
  group_by(Operating_Expense) %>% 
  mutate(Operating_Expense = as.numeric(Operating_Expense),
         Cost_Per_Animal = as.numeric(Cost_Per_Animal),
         LIC = as.numeric(LIC))

#write_csv(expenses_table, "expenses_table.csv")
  

reimbursements_table <- NC_reimbursements_raw %>% 
  mutate(across(c(5:28), as.numeric))

### Reading in Inflation adjusted expenses table and condensed species table

#Desktop
#setwd("C:/Users/john/Documents/GitHub_Data/VCAP-NC-Shelter-Reimbursement-Project-Data")

#Laptop
setwd("C:/Users/johnc/Documents/GitHub_Data/VCAP-NC-Shelter-Reimbursement-Project-Data")


species_table_condensed <- read_csv("species_table_condensed.csv") %>% 
  select(-...1) %>% 
  mutate(Species_Condensed = stringr::str_to_title(Species_Condensed),
         live_outcome = Adopted + Returned) 

NC_inflation_adjusted_expenses_table <- read_csv("inf_adj_expenses_table.csv") %>% 
  mutate(Year = as.character(Year))



```


# Graphics

There were 3 different outcomes listed for each shelter, adopted, returned, and euthanized. The adopted, returned, and euthanized rate is calculated by outcome / sum(3 outcomes).


```{r, echo = FALSE, warning= FALSE, include=FALSE}

aggregate_by_year <- species_table %>%
  mutate(Species = case_when(Species == "Dog" ~ "Dog",
                             Species == "Cat" ~ "Cat",
                             TRUE ~ "Other")) %>%
  group_by(Year, Species) %>% 
  summarise(total_intakes = sum(Intake),
            total_outcomes = sum(Outcome),
            total_adopted = sum(Adopted),
            total_returned = sum(Returned),
            total_euthanized = sum(Euthanized)) %>% 
  plot_ly(type = 'scatter', mode = 'line', x = ~Year, y = ~total_intakes, color = ~Species)



outcome_rates_by_year <- species_table %>%
  filter(Species %in% c("Dog", "Cat", "Raccoon", "Rabbit", "Opossum")) %>% 
  group_by(Species, Year) %>% 
  summarise(total_outcomes = sum(Outcome),
            total_adopted = sum(Adopted),
            total_returned = sum(Returned),
            total_euthanized = sum(Euthanized)) %>% 
  mutate(adopted_rate = round(total_adopted/total_outcomes, 2),
         returned_rate = round(total_returned/total_outcomes, 2),
         euthanized_rate = round(total_euthanized/total_outcomes, 2))

live_release_cat_dogs <- species_table_condensed %>% 
  filter(Species_Condensed %in% c("Cat", "Dog")) %>% 
  group_by(Species_Condensed, Year) %>% 
  summarise(total_outcomes = sum(Outcome),
            total_live_outcomes = sum(live_outcome)) %>% 
  mutate(live_release_rate = total_live_outcomes/total_outcomes)

live_release_other <- species_table_condensed %>% 
  filter(!Species_Condensed %in% c("Cat", "Dog")) %>% 
  group_by(Species_Condensed, Year) %>% 
  summarise(total_outcomes = sum(Outcome),
            total_live_outcomes = sum(live_outcome)) %>% 
  mutate(live_release_rate = total_live_outcomes/total_outcomes)


greater_66 <- live_release_other %>% 
  filter(Year == 2022 & live_release_rate > 0.66) %>%
  pull(Species_Condensed)

less_66 <- live_release_other %>% 
  filter(Year == 2022 & live_release_rate <= 0.66) %>%
  pull(Species_Condensed)


greater_66_dat <- live_release_other %>% 
  filter(Species_Condensed %in% greater_66)

less_66_dat <- live_release_other %>% 
  filter(Species_Condensed %in% less_66)


live_release_cat_dogs_graphic <- plot_ly(data = live_release_cat_dogs, type = "scatter", mode = "line", x = ~Year, y = ~live_release_rate, color = ~Species_Condensed)

live_release_greater_other <- plot_ly(data = greater_66_dat, type = "scatter", mode = "line", x = ~Year, y = ~live_release_rate, color = ~Species_Condensed)

live_release_less_other <- plot_ly(data = less_66_dat, type = "scatter", mode = "line", x = ~Year, y = ~live_release_rate, color = ~Species_Condensed)

live_release_other_graphic <- plot_ly(data = live_release_other, type = "scatter", mode = "line", x = ~Year, y = ~live_release_rate, color = ~Species_Condensed)



adopted_rate <- plot_ly(data = outcome_rates_by_year, type = 'scatter', mode = 'line', x = ~Year, y = ~adopted_rate, color = ~Species)

returned_rate <- plot_ly(data = outcome_rates_by_year, type = 'scatter', mode = 'line', x = ~Year, y = ~returned_rate, color = ~Species)

euthanized_rate <- plot_ly(data = outcome_rates_by_year, type = 'scatter', mode = 'line', x = ~Year, y = ~euthanized_rate, color = ~Species)



### Looking at opperating expense and cost_per_animal

op_cost <- NC_inflation_adjusted_expenses_table %>% 
  filter(is.na(Operating_Expense_inf_adj) == FALSE & Operating_Expense_inf_adj > 5)

Q1 <- quantile(op_cost$Operating_Expense_inf_adj, 0.25)
Q3 <- quantile(op_cost$Operating_Expense_inf_adj, 0.75)
IQR <- Q3 - Q1

# Define bounds
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

# Identify outliers
op_cost$outliers <- op_cost$Operating_Expense_inf_adj < lower_bound | op_cost$Operating_Expense_inf_adj > upper_bound


op_cost_boxplot <- op_cost %>% 
  filter(outliers == FALSE)  %>% 
  plot_ly(y = ~Operating_Expense_inf_adj, x = ~Year, type = "box")

# Customize the layout (optional)
op_cost_boxplot <- op_cost_boxplot %>% layout(
    title = "Operating Cost",
    xaxis = list(title = "Year"),
    yaxis = list(title = "Cost")
)


```

## {.tabset}

### Do rising tides really lift all boats

#### Live Release Rate Cats and Dogs

As dogs and cat live release outcomes get better, can the same be said for other animals. To start, we can see from the graphic below that over the years, the live release rate of cats and dogs has increased. Next, we will look at other animals

```{r, echo = FALSE, warning = FALSE}

live_release_cat_dogs_graphic


```

#### Live Release Rate for Other Animals

We have 11 other animal groups. Since it made the graphic look a little crazy, the other animals were split between two graphics

We can see that some animals have higher live release rates than other animals. Compared to the dog and cat graphic, the increase for some other animals was much more sporadic. Sometimes jumping up by 0.5 on the live relase rate


```{r, echo = FALSE, warning = FALSE}

live_release_greater_other

live_release_less_other

live_release_other_graphic


```



#### Total Intakes by Year in North Carolina


```{r, echo = FALSE}
aggregate_by_year

```


#### Adoption Rate of Dogs, Cats, Raccoons, Rabbits, and Oposssums


```{r, echo = FALSE}

adopted_rate

```


#### Return Rate of Dogs, Cats, Raccoons, Rabbits, and Oposssums


```{r, echo = FALSE}

returned_rate


```


#### Euthanization Rate of Dogs, Cats, Raccoons, Rabbits, and Oposssums

```{r, echo = FALSE}


euthanized_rate


```

### Operation Costs

#### Operation Cost Boxplot

```{r, echo = FALSE}


op_cost_boxplot


```
